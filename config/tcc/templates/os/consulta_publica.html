{% load static %} <!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>
<body>

<div class="search-container px-3">
    <div class="text-center mb-4">
        <h1 class="display-5 fw-bold text-primary">Estado da Reparação</h1>
        <p class="lead">Introduza o código da sua Ordem de Serviço</p>
    </div>

    <div class="card shadow-lg">
        <div class="card-body p-5">
            <form method="get" class="mb-4">
                <div class="input-group input-group-lg">
                    <input type="text" name="codigo" class="form-control" placeholder="Ex: ABC12345" required value="{{ request.GET.codigo }}">
                    <button class="btn btn-primary" type="submit">Pesquisar</button>
                </div>
            </form>

            {% if erro %}
                <div class="alert alert-danger text-center">{{ erro }}</div>
            {% endif %}

            {% if ordem %}
                <div class="mt-4">
                    <h4 class="border-bottom pb-2">Resultado:</h4>
                    
                    <div class="row mt-3">
                        <div class="col-6"><strong>Status Atual:</strong></div>
                        <div class="col-6 text-end">
                            <span class="badge bg-success fs-6">{{ ordem.get_status_atual_display }}</span>
                        </div>
                    </div>
                    
                    <div class="row mt-2">
                        <div class="col-6"><strong>Equipamento:</strong></div>
                        <div class="col-6 text-end">{{ ordem.equipamento.tipo }} {{ ordem.equipamento.marca }}</div>
                    </div>

                    <div class="row mt-2">
                        <div class="col-6"><strong>Data Entrada:</strong></div>
                        <div class="col-6 text-end">{{ ordem.data_abertura|date:"d/m/Y" }}</div>
                    </div>

                    <hr>
                    
                    <h5>Últimas Movimentações:</h5>
                    <ul class="list-group list-group-flush text-small">
                        {% for att in ordem.atualizacaostatus_set.all|slice:":3" %}
                            <li class="list-group-item bg-light">
                                <strong>{{ att.get_novo_status_display }}</strong> 
                                <span class="text-muted small">- {{ att.data_atualizacao|date:"d/m H:i" }}</span>
                                <br>
                                <small class="text-muted">{{ att.observacoes }}</small>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
        <div class="card-footer text-center text-muted">
            <small><a href="{% url 'lista_os' %}">Acesso Reservado (Funcionários)</a></small>
        </div>
    </div>
</div>

</body>
</html>